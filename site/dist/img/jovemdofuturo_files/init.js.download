/* Deep Tracker (c) v3.0.375 */

"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}!function(){var PIANO_EVENTS_LIST=["checkoutComplete","startCheckout","checkoutClose","checkoutCustomEvent","checkoutCancel","checkoutError","loginRequired","loginSuccess","meterExpired","meterActive","experienceExecute","experienceExecutionFailed","showTemplate","showOffer"],PIANO_EVENTS_QUEUE_RESOLVE_FREQUENCY=3e3,PianoEventsQueue=function(){function e(t,i){_classCallCheck(this,e),this.window=t,this.tracker=i,this.enabled=(this.tracker.options||{}).pianoEventsQueue,this.eventsQueue=[],this.initPianoEventsQueue()}return _createClass(e,[{key:"initPianoEventsQueue",value:function(){var e=this;this.enabled&&(this.handlePianoEvents(),setInterval(function(){e.resolveQueue()},PIANO_EVENTS_QUEUE_RESOLVE_FREQUENCY))}},{key:"handlePianoEvents",value:function(){var e=this;this.window.tp=this.window.tp||[],PIANO_EVENTS_LIST.forEach(function(t){e.window.tp.push(["addHandler",t,function(i){var n=void 0;try{n={event:{type:t,data:JSON.parse(JSON.stringify(i))}}}catch(e){(n={event:{type:t},user:i.user}).user&&(delete n.user.firstName,delete n.user.lastName,delete n.user.email)}e.eventsQueue.push(n)}])})}},{key:"resolveQueue",value:function(){var e=this;Array.isArray(this.eventsQueue)&&(this.eventsQueue.forEach(function(t){e.tracker.event(t)}),this.eventsQueue=[])}}]),e}(),SESSION_ATTR="deepbi_user_session",SESSION_STATUS={active:"active",expired:"expired"},SESSION_EXPIRES=18e5,EVENT_PAGE_PING="page-ping",EVENT_PAGE_OPEN="page-open",SESSION_REFERRER="deepbi_user_referrer",COMPLEX_DOMAINS=["com","co","org","net","edu","gov"],SessionManager=function(){function e(t){_classCallCheck(this,e),this.window=t,this.requestData=null,this.status=null,this.eventSeq=0}return _createClass(e,[{key:"getObjValue",value:function(e,t){t=t||window;var i=e.split(".");return this.window.deepUtils.reduce(i,function(e,t){return void 0===e?e:e[t]},t)}},{key:"getRequestDataValue",value:function(e){return this.getObjValue(e,this.requestData)}},{key:"isPagePingEvent",value:function(){return this.getRequestDataValue("event.type")===EVENT_PAGE_PING}},{key:"isPageOpenEvent",value:function(){return this.getRequestDataValue("event.type")===EVENT_PAGE_OPEN}},{key:"isNewCampaign",value:function(){var e,t,i=!1;return this.isPageOpenEvent()&&(e=this.getRequestDataValue("page.domain"),(t=this.getRequestDataValue("referrer.domain"))&&(i=e!==t)),i}},{key:"incrementEventSeq",value:function(){return this.eventSeq++}},{key:"getStatus",value:function(){return this.status}},{key:"isExpired",value:function(){return!Cookies.get(SESSION_ATTR)}},{key:"getId",value:function(){return Cookies.get(SESSION_ATTR).split("|")[0]}},{key:"getLastPageData",value:function(){return this.getRequestDataValue("page")}},{key:"getReferrer",value:function(){return JSON.parse(localStorage.getItem(SESSION_REFERRER))}},{key:"getData",value:function(e){this.requestData=e,this.refresh();var t={session:{eventseq:this.incrementEventSeq(),status:this.getStatus()}};return this.isExpired()||this.window.deepUtils.safeExtend(t.session,{id:this.getId(),lastvisitedpage:this.getLastPageData(),referrer:this.getReferrer()}),t}},{key:"setStatus",value:function(e){this.status=e}},{key:"getEventSeq",value:function(){return this.eventSeq}},{key:"getExpiryTime",value:function(){return new Date((new Date).getTime()+SESSION_EXPIRES)}},{key:"createUuid",value:function(e){return e?(e^16*Math.random()>>e/4).toString(16):([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,this.createUuid)}},{key:"getCurrentDomain",value:function(){var e=this.getRequestDataValue("page.domain"),t=this.getRequestDataValue("page.hostname")||this.window.location.hostname;if(e&&e.indexOf("com.pl")>=0){var i=t.split("."),n=i.length;e=n>=3?i[n-3]+"."+i[n-2]+"."+i[n-1]:e}return e||t}},{key:"getHostname",value:function(){var e=this.window.location.hostname,t=e.split("."),i=t.length;i>2&&(e=COMPLEX_DOMAINS.indexOf(t[i-2])>-1?t[i-3]+"."+t[i-2]+"."+t[i-1]:t[i-2]+"."+t[i-1]);return e}},{key:"create",value:function(e){e=e||this.createUuid(),this.setStatus(SESSION_STATUS.active),Cookies.set(SESSION_ATTR,e+"|"+this.getEventSeq(),{expires:this.getExpiryTime(),domain:this.getCurrentDomain()}),localStorage.setItem(SESSION_REFERRER,JSON.stringify(this.requestData.referrer),{expires:this.getExpiryTime(),domain:this.getCurrentDomain()})}},{key:"isIdle",value:function(){var e=this.getRequestDataValue("user.attention.active");return this.isPagePingEvent()&&0===e}},{key:"new",value:function(){this.eventSeq=0,this.create()}},{key:"continue",value:function(){var e=Cookies.get(SESSION_ATTR)||"";(e=e.split("|"))[1]&&(this.eventSeq=parseInt(e[1],10)+1),this.create(e[0])}},{key:"refresh",value:function(){this.isIdle()?this.isExpired()&&this.setStatus(SESSION_STATUS.expired):this.isExpired()||this.isNewCampaign()?this.new():this.continue()}}]),e}(),DEEP_DATA_COLLECTION_MIN_LENGTH=2,DEEP_DATA_COLLECTION_FREQUENCY=3e3,DeepDataCollector=function(){function e(t,i){_classCallCheck(this,e),this.window=t,this.tracker=i,this.enabled=(this.tracker.options||{}).dataCollector,this.collectedData={},this.initDeepDataCollector()}return _createClass(e,[{key:"initDeepDataCollector",value:function(){var e=this;this.enabled&&(this.collectData(),setInterval(function(){e.collectData()},DEEP_DATA_COLLECTION_FREQUENCY))}},{key:"getCollectionDataSelect",value:function(){return this.window.deepUtils.$w(".DeepDataCollection")}},{key:"getElements",value:function(e,t){var i=this,n=this.window.Sizzle,a=e.querySelectorAll;!this.window.deepUtils.isFunction(a)&&n&&(a=function(t){return n(t,e)});return function t(n){var r=[];return i.window.deepUtils.isString(n)?r=i.window.deepUtils.toArray(a.call(e,n)):Array.isArray(n)&&(r=i.window.deepUtils.flatMap(n,t)),r}(t)}},{key:"extractCollections",value:function(e){var t=this;e.replace(/(\r\n\t|\n|\r\t)/gm,"").split(";").filter(function(e){return e&&e.length>DEEP_DATA_COLLECTION_MIN_LENGTH}).forEach(function(e){var i=e.split("=");if(Array.isArray(i)&&2===i.length){var n=i[0]?i[0].replace(/\s/g,""):null;n&&(t.collectedData[n]=JSON.parse(i[1]))}})}},{key:"collectData",value:function(){var e=this;eachDocumentAndIframes(function(t,i){var n=e.getElements(t,e.getCollectionDataSelect());e.window.deepUtils.each(n,function(t){"script"===t.nodeName.toLowerCase()&&e.extractCollections(t.innerHTML)})})}},{key:"getCollectedData",value:function(){return this.collectedData}}]),e}(),DEEP_GLOBAL_VARIABLE_NAMES=["deepArticleData"],DEEP_GLOBAL_VARIABLES_DATA_COLLECTION_FREQUENCY=3e3,DeepGlobalVariablesDataCollector=function(){function e(t,i){_classCallCheck(this,e),this.window=t,this.tracker=i,this.enabled=(this.tracker.options||{}).globalVariablesDataCollector,this.collectedData={},this.initDeepGlobalVariablesDataCollector()}return _createClass(e,[{key:"initDeepGlobalVariablesDataCollector",value:function(){var e=this;this.enabled&&(this.collectGlobalData(),setInterval(function(){e.collectGlobalData()},DEEP_GLOBAL_VARIABLES_DATA_COLLECTION_FREQUENCY))}},{key:"collectGlobalData",value:function(){var e=this;DEEP_GLOBAL_VARIABLE_NAMES.forEach(function(t){e.window.hasOwnProperty(t)&&(e.collectedData[t]=e.window[t])})}},{key:"getCollectedGobalData",value:function(){return this.collectedData}}]),e}(),PIANO_DATA_COLLECTION_FREQUENCY=3e3,PianoDataCollector=function(){function e(t,i){_classCallCheck(this,e),this.window=t,this.tracker=i,this.enabled=(this.tracker.options||{}).pianoDataCollector,this.collectedData={},this.initPianoDataTimeCount=0,this.initPianoDataCollector()}return _createClass(e,[{key:"initPianoDataCollector",value:function(){var e=this;this.enabled&&(this.collectData(),setInterval(function(){e.collectData()},PIANO_DATA_COLLECTION_FREQUENCY))}},{key:"collectData",value:function(){var e=this;if(this.initPianoDataTimeCount+=10,this.window&&this.window.hasOwnProperty("tp")&&this.window.tp&&this.window.tp.hasOwnProperty("api")&&this.window.tp.api)try{this.window.tp.api.callApi("/access/list",{active:!1},function(t){e.collectedData=t&&Array.isArray(t.data)&&t.data.length?t.data[0]:{},e.collectedData.user&&(delete e.collectedData.user.first_name,delete e.collectedData.user.last_name,delete e.collectedData.user.email),e.initPianoDataTimeCount=1e3})}catch(t){this.initPianoDataTimeCount<1e3&&setTimeout(function(){e.collectData()},10)}else this.initPianoDataTimeCount<1e3&&setTimeout(function(){e.collectData()},10)}},{key:"getCollectedData",value:function(){return this.collectedData}}]),e}(),DeepMediaStream=function(){function e(t,i){_classCallCheck(this,e),this.window=t,this.tracker=i,this.media=(this.tracker.options||{}).media,this.mediaListeners=[],this.events=this.window.deepUtils.$w("abort ended error playing pause seeked timeupdate"),this.plainMediaProperties=this.window.deepUtils.$w("crossOrigin currentSrc currentTime defaultPlaybackRate duration error mediaGroup playbackRate preload volume"),this.booleanMediaProperties=this.window.deepUtils.$w("autoplay controls defaultMuted ended loop muted paused seeking"),this.plainVideoProperties=this.window.deepUtils.$w("poster width height videoWidth videoHeight"),this.initDeepMediaStream()}return _createClass(e,[{key:"initDeepMediaStream",value:function(){var e=this;this.media&&(this.setGroups(),this.setupGroupsStream(),this.window.deepUtils.isObject(this.media)&&this.media.static||setInterval(function(){e.setupGroupsStream()},5e3))}},{key:"getDefaultSelect",value:function(){return this.window.deepUtils.$w("audio video")}},{key:"setGroups",value:function(){var e=this;this.window.deepUtils.isString(this.media)&&this.media.length>0?this.groups=[{select:this.media,events:this.events}]:Array.isArray(this.media)?this.groups=this.window.deepUtils.map(this.media,function(t){return e.window.deepUtils.isString(t)&&t.length>0?{select:t,events:e.events}:e.window.deepUtils.isObject(t)&&(t.select||t.events)?e.window.deepUtils.safeExtend({select:e.getDefaultSelect(),events:e.events},t):void 0}):this.window.deepUtils.isObject(this.media)?this.groups=[this.window.deepUtils.safeExtend({select:this.getDefaultSelect(),events:this.events},this.media)]:this.groups=[{select:this.getDefaultSelect(),events:this.events}]}},{key:"setupGroupsStream",value:function(){var t=this;eachDocumentAndIframes(function(i,n){n&&t.window.deepUtils.each(t.groups,function(a){var r=t.getMediaElements(i,a.select),s=a.events;t.window.deepUtils.isString(s)&&(s=t.window.deepUtils.$w(s)),r.length&&t.window.deepUtils.each(r,function(i){var r=i.nodeName.toLowerCase();"video"!==r&&"audio"!==r||e.setMediaListener(a,i)&&t.setupMediaEvents(i,r,s,n)})})})}},{key:"getMediaElements",value:function(e,t){var i=this,n=this.window.Sizzle,a=e.querySelectorAll;!this.window.deepUtils.isFunction(a)&&n&&(a=function(t){return n(t,e)});return function t(n){var r=[];return i.window.deepUtils.isString(n)?r=i.window.deepUtils.toArray(a.call(e,n)):Array.isArray(n)&&(r=i.window.deepUtils.flatMap(n,t)),r}(t)}},{key:"setupMediaEvents",value:function(e,t,i,n){var a=this,r=getData(e),s=this.window.deepUtils.nowTime(),o=s-1e4,l=0,d=!e.paused,c=!1;this.window.deepUtils.each(i,function(i){if(a.window.deepUtils.isString(i)){var u=t+"-"+i,p=0;addEvent(e,i,function(){var h,w=a.window.deepUtils.nowTime();if("playing"===i&&(c=!0),d&&"timeupdate"===i||0!==l){var f=w-s;if(f>0&&(l+=f),s=w,"timeupdate"===i&&w-o<15e3)return;o=w,h={playingtime:l/1e3},l=0}else if(s=w,"timeupdate"===i)return;d=!e.paused,!c&&"timeupdate"===i&&0===p&&d&&0!==e.currentTime&&a.tracker.event(addIframeAttributes(n,a.enrichMediaEvent(e,{event:{type:t+"-playing",seq:1}},t,r,{playingtime:0}))),a.tracker.event(addIframeAttributes(n,a.enrichMediaEvent(e,{event:{type:u,seq:++p,timestamp:w}},t,r,h)))})}})}},{key:"enrichMediaEvent",value:function(e,t,i,n,a){var r=this,s=t[i]=this.window.deepUtils.create(null);e.id&&(s.id=e.id);var o=this.plainMediaProperties;return"video"==i&&(o=o.concat(this.plainVideoProperties)),this.window.deepUtils.each(o,function(t){var i=e[t];r.window.deepUtils.isNullOrUndefined(i)||!r.window.deepUtils.isNumber(i)&&!(i=(""+i).trim())||(s[t.toLowerCase()]=i)}),this.window.deepUtils.each(this.booleanMediaProperties,function(t){var i=e[t];r.window.deepUtils.isNullOrUndefined(i)||(s[t.toLowerCase()]=!!i)}),this.addMediaSources(e,s),a&&this.window.deepUtils.safeExtend(s,a),this.window.deepUtils.deepExtend(s,n),t}},{key:"addMediaSources",value:function(e,t){var i=this,n={},a=e.getAttribute("src");a=a&&this.window.deepUtils.isString(a)?[a]:[],this.window.deepUtils.each(e.getElementsByTagName("source"),function(t,r){var s=e.getAttribute("src");s&&i.window.deepUtils.isString(s)&&(a.push(s),n[r]={src:s,type:e.type})}),a.length>0&&(t.src=a.length>1?a:a[0]),this.window.deepUtils.isEmpty(n)||(t.sources=n)}}],[{key:"setMediaListener",value:function(e,t){return Array.isArray(e.mediaListeners)||(e.mediaListeners=[]),!e.mediaListeners.includes(t)&&e.mediaListeners.push(t)}}]),e}(),SCORING_MANAGER_LOCAL_STORAGE_ITEM="deepScoring",ScoringManager=function(){function e(t,i,n){_classCallCheck(this,e),this.tracker=t,this.streamKey=i,this.deepcookie=n,this.scoringParams=(this.tracker.options||{}).scoring,this.scoringTypes=["score","level","profile"],this.scoring=this.getScoringData(),this.init()}return _createClass(e,[{key:"sendInitialRequest",value:function(){return"GF8KGFuj0MDz"===this.streamKey||this.scoringParams&&this.scoringParams.hasOwnProperty("initialRequest")&&this.scoringParams.initialRequest}},{key:"getObjectFieldValue",value:function(e,t){if(!e)return null;var i=t.split(".");if("string"==typeof i||1===i.length)return e[i[0]];var n=i.join(".").replace(i[0]+".","");return this.getObjectFieldValue(e[i[0]],n)}},{key:"getDefaultIdName",value:function(){return this.scoringParams&&this.scoringParams.hasOwnProperty("defaultId")&&this.scoringParams.defaultId&&this.scoringParams.defaultId.name?this.scoringParams.defaultId.name:"deepcookie"}},{key:"getScoringData",value:function(){try{return JSON.parse(localStorage.getItem("deepScoring"))||{}}catch(e){return console.error("Error inside getScoringData.",e),{}}}},{key:"updateScoringData",value:function(){localStorage.setItem(SCORING_MANAGER_LOCAL_STORAGE_ITEM,JSON.stringify(this.scoring))}},{key:"init",value:function(t){var i=this;this.scoringTypes.forEach(function(n){if(i.scoring[n]={},i.sendInitialRequest()){var a=new XMLHttpRequest,r=i.getDefaultIdName(),s="deepcookie"===r?i.deepcookie:i.getObjectFieldValue(t,r);a.open("GET","https://scoring.deep.bi/score/"+i.streamKey+"/"+s+"?id="+r+"&column="+n,!0),a.onreadystatechange=function(){i.scoring[n].hasOwnProperty(r)||(i.scoring[n][r]={}),4===a.readyState&&200===a.status&&(i.scoring[n][r][s]=e.parseResponse(a.response),i.updateScoringData())},a.send(null)}})}},{key:"request",value:function(t){var i=this;return new Promise(function(n,a){if(!i.scoring[t.type])return a("Incorrect scoring type.");var r=new XMLHttpRequest;r.open("GET","https://scoring.deep.bi/score/"+i.streamKey+"/"+t.idValue+"?id="+t.idName+"&column="+t.type,!0);var s=setTimeout(function(){var e=i.getScoringData();try{return n(e[t.type][t.idName][t.idValue])}catch(e){return n({})}},50);r.onreadystatechange=function(){4===r.readyState&&200===r.status&&(clearTimeout(s),i.scoring[t.type].hasOwnProperty(t.idName)||(i.scoring[t.type][t.idName]={}),i.scoring[t.type][t.idName][t.idValue]=e.parseResponse(r.response),i.updateScoringData(),n(i.scoring[t.type][t.idName][t.idValue]))},r.send(null)})}},{key:"get",value:function(e,t){var i=this;return new Promise(function(n,a){if(!i.deepcookie)return a("Error: deepcookie not found.");if(!i.streamKey)return a("Error: streamKey not found.");var r=e&&e.force,s=e&&e.type?e.type:"score",o=e&&e.hasOwnProperty("id")&&e.id.name&&i.getObjectFieldValue(t,e.id.name)?e.id.name:i.getDefaultIdName(),l="deepcookie"===o?i.deepcookie:i.getObjectFieldValue(t,o);if(!r&&i.scoring[s]&&i.scoring[s][o]&&i.scoring[s][o][l])return n(i.scoring[s][o][l]);i.request({type:s,idName:o,idValue:l,force:r}).then(function(e){return n(e)}).catch(function(e){a(e)})})}}],[{key:"parseResponse",value:function(e){if("string"==typeof e)try{e=JSON.parse(e)}catch(t){console.log("Error while parsing response from scoring API:",e)}return"object"!==(void 0===e?"undefined":_typeof(e))?null:e}}]),e}(),AVAILABLE_SERVICES={smartadserver:"//sync.smartadserver.com/getuid?url="},FALLBACK_SERVICE="smartadserver",CookieMatching=function(){function e(t,i,n){_classCallCheck(this,e),this.window=t,this.streamKey=n,this.localStorage=t.localStorage,this.tracker=i,this.options=this.tracker.options||{},this.redirectUrl="https://"+this.window.deepUtils.getApiUrl()+"/v1/cm?sas_uid=[sas_uid]&stream=",this.initCookieMatching()}return _createClass(e,[{key:"initCookieMatching",value:function(){var e=this.getCookieMatchingServices();e.length&&window.localStorage&&this.loadSASIDRequestScript(e)}},{key:"getServiceUrl",value:function(e){return AVAILABLE_SERVICES[e]+encodeURIComponent(this.redirectUrl)}},{key:"loadSASIDRequestScript",value:function(e){for(var t=0;t<e.length;t++)appendHead(makeScriptNode(this.getServiceUrl(e[t])+this.streamKey))}},{key:"isServiceAvailable",value:function(e){return e&&AVAILABLE_SERVICES[e]}},{key:"getCookieMatchingServices",value:function(){var e=[],t=this.options.usermatching,i=this.options.cookie_matching,n=this.window.deepUtils.isString(t)?t.split(/,\s*/):Array.isArray(t)?t:[];i&&e.push(FALLBACK_SERVICE);for(var a=0;a<n.length;a++)this.isServiceAvailable(n[a])&&-1===e.indexOf(n[a])&&e.push(n[a]);return e}}]),e}(),DOMAIN_CONFIG=[{api_url:"vhsrwd.aip24.pl",domains:["naszemiasto.pl","echodnia.eu","telemagazyn.pl","pomorska.pl","gazetawroclawska.pl","dziennikzachodni.pl","gazetakrakowska.pl","poranny.pl","nowiny24.pl","gloswielkopolski.pl","kurierlubelski.pl","gazetalubuska.pl","gk24.pl","gp24.pl","nto.pl","dzienniklodzki.pl","wspolczesna.pl","expressilustrowany.pl","gs24.pl","dziennikbaltycki.pl","expressbydgoski.pl","dziennikpolski24.pl","polskatimes.pl","gol24.pl","strefabiznesu.pl","nowosci.com.pl","sportowy24.pl","motofakty.pl","to.com.pl","regiodom.pl","e-ogrodek.pl","forumbudowlane.pl","e-instalacje.pl","e-dach.pl","e-mieszkanie.pl","e-sciany.pl","demaskator24.pl","e-lazienki.pl","stronazdrowia.pl","e-aranzacje.pl","e-izolacje.pl","e-okna.pl","e-projekty.pl","urzadzone.pl","forumogrodowe.pl","budzetalert.pl","regiopraca.pl","alegratka.pl","e-bezposrednio.pl","e-budownictwo.pl","e-budownictwotv.pl","glos.tv","gra.pl","jarmark.com.pl","juniorfutbol.pl","juniormedia.pl","kredytybudowlane.pl","miastakobiet.pl","mieszkaniezaczytanie.pl","naszahistoria.pl","ekstramagazyn.pl","strefaagro.pl","naszekomunikaty.pl","nekrologi.net","prasa24.pl","sandecja.pl","swieta24.pl","tygodnikits.pl","grdev.pl","stronakobiet.pl","grrc.pl","polskapress.pl","widermobile.pl","gratka.pl"]}],DeepUtils=function(){function e(t){_classCallCheck(this,e),this.window=t,this.hasOwnProperty={}.hasOwnProperty||function(e){return e in this},this.create=this.isFunction(Object.create)?Object.create:function(){return{}},this.nowTime=this.isFunction(Date.now)?Date.now:function(){return(new Date).getTime()},this.utcOffset=-(new Date).getTimezoneOffset(),this.toString={}.toString}return _createClass(e,[{key:"$w",value:function(e){var t=e?e.trim().split(/\s+/):[];return t[0]?t:[]}},{key:"isPlainObject",value:function(e){return"[object Object]"===this.toString.call(e)}},{key:"isObject",value:function(e){return null!==e&&"object"===(void 0===e?"undefined":_typeof(e))}},{key:"isFunction",value:function(e){return"function"==typeof e}},{key:"isBoolean",value:function(e){return"boolean"==typeof e}},{key:"isString",value:function(e){return"string"==typeof e}},{key:"isNumber",value:function(e){return"number"==typeof e}},{key:"isNull",value:function(e){return null===e}},{key:"isNullOrUndefined",value:function(e){return null==e}},{key:"isUndefined",value:function(e){return void 0===e}},{key:"isEmpty",value:function(e){if(Array.isArray(e)||this.isString(e))return 0===e.length;if(this.isObject(e)){for(var t in e)return!1;return!0}return!this.isFunction(e)}},{key:"charCodeAt",value:function(e,t){return e.charCodeAt(t||0)}},{key:"charAt",value:function(e,t){return e.charAt(t||0)}},{key:"each",value:function(e,t){for(var i=Object(e),n=i.length>>>0,a=0;a<n;++a)a in i&&t(i[a],a,i)}},{key:"map",value:function(e,t){var i=Object(e),n=new Array(i.length>>>0);return this.each(i,function(e,i,a){n[i]=t(e,i,a)}),n}},{key:"toArray",value:function(e){return this.map(e,function(e){return e})}},{key:"every",value:function(e,t){for(var i=Object(e),n=i.length>>>0,a=0;a<n;++a)if(a in i&&!t(i[a],a,i))return!1;return!0}},{key:"reduce",value:function(e,t){var i,n=Object(e),a=n.length>>>0,r=0;if(3==arguments.length)i=arguments[2];else{for(;!(r in n);++r)if(r>=a)return;i=n[r++]}for(;r<a;r++)r in n&&(i=t(i,n[r],r,n));return i}},{key:"flatMap",value:function(e,t){return this.reduce(this.map(e,t),function(e,t){return e.concat(t)},[])}},{key:"safeExtend",value:function(e,t){for(var i in t)this.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}},{key:"shallowClone",value:function(e){return this.safeExtend(this.create(null),e)}},{key:"deepAssign",value:function(e,t,i){if(this.isString(t)){for(var n=t.split("."),a=0,r=n.length-1;a<r;++a){var s=e[t=n[a]];e=this.isPlainObject(s)?s:e[t]=this.create(null)}t=n[r]}Array.isArray(i)?this.deepExtendArray(e[t]=[],i):this.isPlainObject(i)?this.isPlainObject(s=e[t])?this.deepExtend(s,i):this.deepExtend(e[t]=this.create(null),i):this.isObject(i)?this.isFunction(i.toJSON)&&this.deepAssign(e,t,i.toJSON()):e[t]=i}},{key:"deepAssignNoOverwrite",value:function(e,t,i){if(this.isString(t)){for(var n=t.split("."),a=0,r=n.length-1;a<r;++a){var s=e[t=n[a]];if(this.isPlainObject(s))e=s;else{if(!this.isUndefined(s))return;e=e[t]=this.create(null)}}t=n[r]}s=e[t],Array.isArray(i)?this.isUndefined(s)&&this.deepExtendArray(e[t]=[],i):this.isPlainObject(i)?this.isUndefined(s)?this.deepExtend(e[t]=this.create(null),i):this.isPlainObject(s)&&this.deepExtend(s,i,!0):this.isObject(i)?this.isFunction(i.toJSON)&&this.deepAssignNoOverwrite(e,t,i.toJSON()):this.isUndefined(s)&&(e[t]=i)}},{key:"deepExtendArray",value:function(e,t){for(var i=e.length=t.length;i-- >0;)i in t&&this.deepAssign(e,i,t[i]);return e}},{key:"deepExtend",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];for(var n in t)this.hasOwnProperty.call(t,n)&&(i?this.deepAssignNoOverwrite(e,n,t[n]):this.deepAssign(e,n,t[n]));return e}},{key:"deepClone",value:function(e){return this.deepExtend(this.create(null),e)}},{key:"matchHostname",value:function(e,t){return e[e.length-1]===t[t.length-1]&&e[e.length-2]===t[t.length-2]}},{key:"getApiUrl",value:function(){var e=this,t="api.deep.bi",i=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:null)||this.window.location.hostname||this.window.location.host;if(!i)return t;var n=i.split(".");return n.length<2?t:(DOMAIN_CONFIG.forEach(function(i){Array.isArray(i.domains)&&i.domains.forEach(function(a){var r=a.split(".");if(e.matchHostname(r,n))return t=i.api_url})}),t)}}]),e}(),DeepBrowserUtils=function(){function e(t){_classCallCheck(this,e),this.window=t}return _createClass(e,[{key:"extend",value:function(){for(var e=1;e<arguments.length;e++)for(var t in arguments[e])arguments[e].hasOwnProperty(t)&&(arguments[0][t]=arguments[e][t]);return arguments[0]}},{key:"getDocumentHeight",value:function(){return Math.round(Math.max(document.documentElement.scrollHeight,document.body.scrollHeight,document.documentElement.offsetHeight,document.body.offsetHeight,document.documentElement.clientHeight))}},{key:"getElementHeight",value:function(e){return Math.round(Math.max(e.scrollHeight,e.offsetHeight,e.clientHeight))}},{key:"getWindowHeight",value:function(){return Math.round(window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight)}},{key:"getPageYOffset",value:function(){var e=window.pageYOffset||("CSS1Compat"===document.compatMode?document.documentElement.scrollTop:document.body.scrollTop);return Math.round(e)}},{key:"getElementYOffsetToDocumentTop",value:function(e){return Math.round(e.getBoundingClientRect().top+this.getPageYOffset())}},{key:"getElementsBySelector",value:function(e){return void 0!==window.jQuery?window.jQuery(e):void 0!==document.querySelectorAll?document.querySelectorAll(e):"#"===e.charAt(0)?document.getElementById(e.substr(1)):void 0}},{key:"throttle",value:function(e,t){var i,n,a,r=null,s=0,o=function(){s=new Date,r=null,a=e.apply(i,n)};return function(){var l=new Date;s||(s=l);var d=t-(l-s);return i=this,n=arguments,d<=0?(clearTimeout(r),r=null,s=l,a=e.apply(i,n)):r||(r=setTimeout(o,d)),a}}},{key:"getScrollDistance",value:function(){return this.getPageYOffset()+this.getWindowHeight()}},{key:"isOnScreen",value:function(e){var t,i,n,a=!1;return e&&(t=window.innerHeight,i=e.getBoundingClientRect().top,n=e.getBoundingClientRect().bottom,a=t>=i&&n>0),a}}]),e}(),DeepQueryString=function(){function e(t){_classCallCheck(this,e),this.window=t,this.allowedQueryParams=this.window.deepUtils.$w("utm_source utm_medium utm_campaign utm_term utm_content ref src page promo smclient")}return _createClass(e,[{key:"parseQueryString",value:function(e,t,i){t=t||"&",i=i||"=";var n={};if(!this.window.deepUtils.isString(e)||!e)return n;for(var a=/\+/g,r=(e=e.split(t)).length,s=0;s<r;++s){var o,l,d=e[s].replace(a,"%20"),c=d.indexOf(i),u=void 0,p=void 0;c>=0?(u=d.substr(0,c),p=d.substr(c+1)):(u=d,p=""),o=decodeURIComponent(u),l=decodeURIComponent(p),this.window.deepUtils.hasOwnProperty.call(n,o)?Array.isArray(n[o])?n[o].push(l):n[o]=[n[o],l]:n[o]=l}return n}},{key:"locationSearchToQuery",value:function(e){var t=this,i=e.search;if(this.window.deepUtils.isString(i)&&"?"===i.substr(0,1)){var n={},a=this.parseQueryString(i.substr(1));if(this.window.deepUtils.each(this.allowedQueryParams,function(e){t.window.deepUtils.hasOwnProperty.call(a,e)&&(n[e]=a[e])}),!this.window.deepUtils.isEmpty(n))return n}}}]),e}(),DeepElementViewTimer=function(){function e(t){_classCallCheck(this,e),this.element=t,this.params={},this.viewabletime=0,this.markTime=0,this.watch()}return _createClass(e,[{key:"getElapsedTime",value:function(){var e=this.viewabletime;return this.viewabletime=0,e}},{key:"getMarkTime",value:function(){var e=this.markTime;return this.markTime=0,e}},{key:"watch",value:function(){var e=this;setInterval(function(){!visibly.hidden()&&window.deepBrowserUtils.isOnScreen(e.element.domEl)&&(e.viewabletime+=1e3,e.markTime+=1e3)},1e3)}}]),e}(),DEEPBI_USER_DEEPCOOKIE="deepbi_user_deepcookie",DEEPBI_USER_FIRSTPARTY="deepbi_user_firstparty",DEEPBI_FIRSTPARTY_COOKIE="deepbi_firstparty_cookie",DeepTracker=function(){function e(t,i){_classCallCheck(this,e),this.initialized=!0,this.window=t,this.document=i,this.deepcookie="",this._initializationDate=new Date,this.trackers={},this.triggers={},this.errors=[],this.mediaStreams={},this.cookieMatchers={},this.sharedData={}}return _createClass(e,[{key:"_createAppender",value:function(e,t,i,n,a){var r=this,s=Object.freeze,o=function(o){s&&"object"==(void 0===o?"undefined":_typeof(o))&&null!==o&&s(o);var l=i.push(o),d=r.triggers[n];if(d)for(var c=0;c<d.length;++c)d[c](t,o,e[5],l);return a};return a||(a=o),o}},{key:"setSharedData",value:function(e){this.sharedData=e}},{key:"addError",value:function(e){this.errors.push([new Date,e])}},{key:"hash",value:function(e){function t(){return e}return t}},{key:"each",value:function(e,t){for(var i in t||(t=1),this.trackers)for(var n=this.trackers[i],a=n[t],r=n[5],s=0;s<a.length;++s)e(i,a[s],r,s);(this.triggers[t]||(this.triggers[t]=[])).push(e)}},{key:"forEachStream",value:function(e){for(var t in this.trackers)e(t)}},{key:"getTracker",value:function(e){return this.trackers[e][0]}},{key:"getInitTime",value:function(){return this._initializationDate}},{key:"setDeepcookie",value:function(e,t){this.deepcookie=e,this.streamKey=t,Cookies.set(DEEPBI_USER_DEEPCOOKIE,this.deepcookie,{domain:window.sessionManager.getCurrentDomain()}),this.initScoring(t)}},{key:"setFirstPartyCookie",value:function(e){var t=window.sessionManager.getHostname();Cookies.set(DEEPBI_FIRSTPARTY_COOKIE,e,{domain:t,expires:365})}},{key:"getDeepcookie",value:function(){return Cookies.get(DEEPBI_USER_DEEPCOOKIE)||this.deepcookie}},{key:"getFirstPartyCookie",value:function(){return Cookies.get(DEEPBI_FIRSTPARTY_COOKIE)}},{key:"getOldFirstPartyCookie",value:function(){return Cookies.get(DEEPBI_USER_FIRSTPARTY)}},{key:"initScoring",value:function(e){var t=this.getTracker(e);this.scoringManager=new ScoringManager(t,this.streamKey,this.deepcookie)}},{key:"getScore",value:function(e){return this.scoringManager.get(e,this.sharedData)}},{key:"options",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.streamKey;return this.trackers[e][0].options}},{key:"track",value:function(e,t,i){var n,a,r,s,o,l,d=this.trackers[e];return d?(n=d[0],t&&(d[5]=t)):(this.trackers[e]=d=[0,a=[],r=[],s=[],o=[],t,l=[]],d[0]=n=this._createAppender(d,e,a,1),n.event=this._createAppender(d,e,r,2,n),n.transform=this._createAppender(d,e,s,3,n),n.newpage=this._createAppender(d,e,o,4,n),n.hash=this.hash,n.options=i||{},n.addElements=this._createAppender(d,e,l,6,n)),n}},{key:"enableErrorReporting",value:function(){var e=this;this.window.addEventListener("error",function(t){e.addError([new Date,t])},!0),this.errorReporting=!0}},{key:"testErrorReporting",value:function(){this.window.dispatchEvent(new Event("error"))}},{key:"initialize",value:function(){this.initialized=!0}},{key:"isInitialized",value:function(){return this.initialized}},{key:"createMediaStream",value:function(e){var t=this.getTracker(e);this.mediaStreams[e]=new DeepMediaStream(this.window,t)}},{key:"collectData",value:function(e){var t=this.getTracker(e);this.deepDataCollector=new DeepDataCollector(this.window,t)}},{key:"applyCollectedData",value:function(e){e&&e.data&&e.data.event&&(e.data.event.collectedData=this.deepDataCollector.getCollectedData())}},{key:"collectPianoData",value:function(e){var t=this.getTracker(e);this.pianoDataCollector=new PianoDataCollector(this.window,t)}},{key:"applyPianoData",value:function(e){e&&e.data&&e.data.event&&(e.data.event.pianoCollectedData=this.pianoDataCollector.getCollectedData())}},{key:"handlePianoEvents",value:function(e){var t=this.getTracker(e);this.pianoEventsQueue=new PianoEventsQueue(this.window,t)}},{key:"collectGlobalVariablesData",value:function(e){var t=this.getTracker(e);this.deepGlobalVariablesDataCollector=new DeepGlobalVariablesDataCollector(this.window,t)}},{key:"applyGlobalVariablesCollectedData",value:function(e){if(e&&e.data&&e.data.event){var t=this.deepGlobalVariablesDataCollector.getCollectedGobalData();Object.keys(t).forEach(function(i){e.data.event.collectedData[i]=t[i]})}}},{key:"initializeCookieMatcher",value:function(e){var t=this.getTracker(e);this.cookieMatchers[e]||(this.cookieMatchers[e]=new CookieMatching(this.window,t,e))}},{key:"initTime",get:function(){return this._initializationDate}}]),e}();window.deepUtils=new DeepUtils(window),window.deepBrowserUtils=new DeepBrowserUtils(window),window.deepQueryString=new DeepQueryString(window),window.deepTracker=window.deepTracker||new DeepTracker(window,document),window.sessionManager=new SessionManager(window),window.deepTracker.enableErrorReporting();var GET_ELEMENTS_BY_TAG_NAME="getElementsByTagName",APPEND_CHILD="appendChild",LOCATION="location",HEAD="head",IFRAME="iframe",CONTENT_WINDOW="contentWindow",NODE_TYPE="nodeType",doc,current=new Function("return this;")(),win=current.top;try{doc=win.document}catch(e){}void 0===doc&&(win=current,doc=win.document);var performance=win.performance||{};function getText(e){for(var t,i="",n=0;e[n];++n)3===(t=e[n])[NODE_TYPE]||4===t[NODE_TYPE]?i+=t.nodeValue:8!==t[NODE_TYPE]&&(i+=getText(t.childNodes));return i}function getData(e,t,i){return window.deepUtils.isUndefined(t)?window.deepUtils.reduce(e.attributes,function(e,t){var i=(""+t.name).match(/^data-(.+)$/);return i&&(e[i[1].replace(/-/g,".")]=""+t.value),e},window.deepUtils.create(null)):e.getAttribute("data-"+t)||i}function makeScriptNode(e){var t=doc.createElement("script");return t.type="application/javascript",t.async=!0,t.src="http"+("https:"===doc[LOCATION].protocol?"s:":":")+e,t}function appendHead(e){for(var t;!(t=doc[GET_ELEMENTS_BY_TAG_NAME](HEAD)[0]);)doc[GET_ELEMENTS_BY_TAG_NAME]("html")[0][APPEND_CHILD](doc.createElement(HEAD));t[APPEND_CHILD](e)}var cuid=(discreteValues=Math.pow(36,4),pad=function(e,t){var i="000000000"+e;return i.substr(i.length-t)},_globalCount=function(){var e=function(){var e,t=0;for(e in win)t++;return t}();return _globalCount=function(){return e},e},browserPrint=function(){return pad((win.navigator.mimeTypes.length+win.navigator.userAgent.length).toString(36)+_globalCount().toString(36),4)},function(){var e=window.deepUtils.nowTime().toString(36),t=browserPrint(),i=pad((Math.random()*discreteValues<<0).toString(36),4);return"c"+e+pad(win[LOCATION].href.length.toString(36),2)+t+i}),discreteValues,pad,_globalCount,browserPrint;function parseUrl(e){var t=doc.createElement("div");return t.innerHTML="<a></a>",t.firstChild.href=e,t.innerHTML=t.innerHTML,t.firstChild}var LOCATION_ATTRIBUTES=window.deepUtils.$w("protocol host hostname port href search hash");function locationAttributes(e,t){var i=window.deepUtils.create(null);return window.deepUtils.each(LOCATION_ATTRIBUTES,function(t){i[t]=e[t]}),i.path=e.pathname,t&&(i.domain=domainFromLocation(e)),i.query=window.deepQueryString.locationSearchToQuery(e),i}function domainFromLocation(e){var t=e.hostname;if(!window.deepUtils.isString(t))return t;if(/^\d+\.\d+\.\d+\.\d+$/.test(t))return t;var i=t.lastIndexOf(".");if(i<0)return t;var n=t.indexOf(".");return n===i?t:t.substr(n+1)}function addEvent(e,t,i){e.addEventListener?e.addEventListener(t,i,!1):e.attachEvent?e.attachEvent("on"+t,i):e["on"+t]=i}function removeEvent(e,t,i){e.removeEventListener?e.removeEventListener(t,i,!1):e.detachEvent?e.detachEvent("on"+t,i):e["on"+t]=null}function onLoad(e,t){"complete"===e.document.readyState?e.setTimeout(t,150):addEvent(e,"load",t)}var DOM_CONTENT_LOADED="DOMContentLoaded";function onDOMContentLoaded(e,t,i){var n,a,r;function s(){n||(n=!0,a&&e.clearTimeout(a),i(e,t))}if(e===win||t.URL.indexOf("about:"))switch(t.readyState){case"complete":case"interactive":return void s();default:window.deepUtils.isFunction(t.addEventListener)?addEvent(t,DOM_CONTENT_LOADED,s):(window.deepUtils.isFunction(t.attachEvent)&&addEvent(t,"readystatechange",function e(){var i=t.readyState;"interactive"!==i&&"complete"!==i||(removeEvent(t,"readystatechange",e),s())}),e===win&&(a=e.setTimeout(function i(){try{t.documentElement.doScroll("left")}catch(t){return void(a=e.setTimeout(i,50))}s()},50)))}else t=null,r=e[CONTENT_WINDOW],window.deepUtils.isFunction(r.addEventListener)&&r.addEventListener(DOM_CONTENT_LOADED,s,!0);addEvent(e,"load",s)}function eachDocumentAndIframes(e){e(doc),eachIframeRecursive(win[LOCATION],doc,e)}function eachIframeRecursive(e,t,i){window.deepUtils.each(t[GET_ELEMENTS_BY_TAG_NAME](IFRAME),function(t){var n,a;try{a=parseUrl(a=t.src),e.protocol===a.protocol&&e.host===a.host&&(n=findIframeDocument(t))}catch(e){}n&&attachToIframe(t,n,function(n){i(n,t),eachIframeRecursive(e,n,i)})})}function findIframeDocument(e){return e.contentDocument||e[CONTENT_WINDOW].document}function attachToIframe(e,t,i){onDOMContentLoaded(e,t,function(e,t){try{t||(t=findIframeDocument(e))}catch(e){}t&&i(t)})}function addIframeAttributes(e,t){return e&&(t.iframe=locationAttributes(e[CONTENT_WINDOW][LOCATION],1)),t}function encodeUtf8(e){return e.replace(/[\u0080-\u07ff]/g,function(e){return e=window.deepUtils.charCodeAt(e),String.fromCharCode(192|e>>6,128|63&e)}).replace(/[\u0800-\uffff]/g,function(e){return e=window.deepUtils.charCodeAt(e),String.fromCharCode(224|e>>12,128|e>>6&63,128|63&e)})}var urlSafeEncodeBase64=(keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",function(e){var t,i,n,a=0,r="";for(e=encodeUtf8(e);a<e.length;)t=window.deepUtils.charCodeAt(e,a++),i=window.deepUtils.charCodeAt(e,a++),n=window.deepUtils.charCodeAt(e,a++),r+=window.deepUtils.charAt(keyStr,(255&t)>>2)+window.deepUtils.charAt(keyStr,(3&t)<<4|(255&i)>>4)+(isNaN(i)?"":window.deepUtils.charAt(keyStr,(15&i)<<2|(255&n)>>6))+(isNaN(n)?"":window.deepUtils.charAt(keyStr,63&n));return r}),keyStr,hash128=function(){function e(e,t){return(65535&e)*t+(((e>>>16)*t&65535)<<16)}function t(e,t){return e<<t|e>>>32-t}function i(t){return t=e(t^=t>>>16,2246822507),t=e(t^=t>>>13,3266489909),t^=t>>>16}function n(e){return("00000000"+(e>>>0).toString(16)).slice(-8)}return function(a,r){a=a||"",r=r||0;for(var s=a.length%16,o=a.length-s,l=r,d=r,c=r,u=r,p=0,h=0,w=0,f=0,m=597399067,v=2869860233,g=951274213,y=2716044179,E=0;E<o;E+=16)p=255&window.deepUtils.charCodeAt(a,E)|(255&window.deepUtils.charCodeAt(a,E+1))<<8|(255&window.deepUtils.charCodeAt(a,E+2))<<16|(255&window.deepUtils.charCodeAt(a,E+3))<<24,h=255&window.deepUtils.charCodeAt(a,E+4)|(255&window.deepUtils.charCodeAt(a,E+5))<<8|(255&window.deepUtils.charCodeAt(a,E+6))<<16|(255&window.deepUtils.charCodeAt(a,E+7))<<24,w=255&window.deepUtils.charCodeAt(a,E+8)|(255&window.deepUtils.charCodeAt(a,E+9))<<8|(255&window.deepUtils.charCodeAt(a,E+10))<<16|(255&window.deepUtils.charCodeAt(a,E+11))<<24,f=255&window.deepUtils.charCodeAt(a,E+12)|(255&window.deepUtils.charCodeAt(a,E+13))<<8|(255&window.deepUtils.charCodeAt(a,E+14))<<16|(255&window.deepUtils.charCodeAt(a,E+15))<<24,l=t(l^=p=e(p=t(p=e(p,m),15),v),19),l=e(l+=d,5)+1444728091,d=t(d^=h=e(h=t(h=e(h,v),16),g),17),d=e(d+=c,5)+197830471,c=t(c^=w=e(w=t(w=e(w,g),17),y),15),c=e(c+=u,5)+2530024501,u=t(u^=f=e(f=t(f=e(f,y),18),m),13),u=e(u+=l,5)+850148119;switch(p=0,h=0,w=0,f=0,s){case 15:f^=window.deepUtils.charCodeAt(a,E+14)<<16;case 14:f^=window.deepUtils.charCodeAt(a,E+13)<<8;case 13:u^=f=e(f=t(f=e(f^=window.deepUtils.charCodeAt(a,E+12),y),18),m);case 12:w^=window.deepUtils.charCodeAt(a,E+11)<<24;case 11:w^=window.deepUtils.charCodeAt(a,E+10)<<16;case 10:w^=window.deepUtils.charCodeAt(a,E+9)<<8;case 9:c^=w=e(w=t(w=e(w^=window.deepUtils.charCodeAt(a,E+8),g),17),y);case 8:h^=window.deepUtils.charCodeAt(a,E+7)<<24;case 7:h^=window.deepUtils.charCodeAt(a,E+6)<<16;case 6:h^=window.deepUtils.charCodeAt(a,E+5)<<8;case 5:d^=h=e(h=t(h=e(h^=window.deepUtils.charCodeAt(a,E+4),v),16),g);case 4:p^=window.deepUtils.charCodeAt(a,E+3)<<24;case 3:p^=window.deepUtils.charCodeAt(a,E+2)<<16;case 2:p^=window.deepUtils.charCodeAt(a,E+1)<<8;case 1:l^=p=e(p=t(p=e(p^=window.deepUtils.charCodeAt(a,E),m),15),v)}return l^=a.length,l+=d^=a.length,l+=c^=a.length,d+=l+=u^=a.length,c+=l,u+=l,l=i(l),l+=d=i(d),l+=c=i(c),d+=l+=u=i(u),c+=l,u+=l,n(l)+n(d)+n(c)+n(u)}}(),jsonParse=window.deepUtils.isObject(win.JSON)&&window.deepUtils.isFunction(win.JSON.parse)?win.JSON.parse:function(sJSON){return eval("("+sJSON+")")},stringify=(escMap={'"':'\\"',"\\":"\\\\","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t"},escFunc=function(e){return escMap[e]||"\\u"+(window.deepUtils.charCodeAt(e)+65536).toString(16).substr(1)},escRE=/[\\"\u0000-\u001F\u2028\u2029]/g,function(e,t){return function e(t,i,n,a){if((window.deepUtils.isObject(t)&&!Array.isArray(t)&&!window.deepUtils.isPlainObject(t)||window.deepUtils.isFunction(t))&&window.deepUtils.isFunction(t.toJSON)&&(t=t.toJSON()),window.deepUtils.isFunction(n)&&(t=n(i,t)),window.deepUtils.isNull(t))return"null";if(window.deepUtils.isNumber(t))return isFinite(t)?t.toString():"null";if(window.deepUtils.isBoolean(t))return t.toString();if(window.deepUtils.isObject(t)){if(Array.isArray(t)){for(var r="[",s=0;s<t.length;s++)r+=(s?",":"")+e(t[s],""+s,n,"null");return r+"]"}if(window.deepUtils.isPlainObject(t)){var o,l=[];for(var d in t)window.deepUtils.hasOwnProperty.call(t,d)&&!window.deepUtils.isUndefined(o=e(t[d],d,n))&&l.push(e(d)+":"+o);return"{"+l.join(",")+"}"}}else if(window.deepUtils.isString(t))return'"'+t.replace(escRE,escFunc)+'"';return a}(e,"",t)}),escMap,escFunc,escRE,Cookies;function sendJsonP(e,t,i,n){var a=hookUpGlobal(o),r=makeScriptNode(apiUrl+e+"/events.js?accessKey="+encodeURIComponent(t)+"&cb="+encodeURIComponent(a)+"&b64="+urlSafeEncodeBase64(stringifyAndHash(i)));appendHead(r);var s=win.setTimeout(function(){o(!1)},2e4);function o(e){win.clearTimeout(s);var t=n;a&&delete win[a],n=a=null,t&&t(e);var i=r.parentNode;i&&i.removeChild(r)}}function hookUpGlobal(e){var t;do{t="_deep_bi_"+cuid()}while(t in win);return win[t]=e,t}Cookies=function(){function e(){for(var e=0,t={};e<arguments.length;e++){var i=arguments[e];for(var n in i)t[n]=i[n]}return t}return function t(i){function n(t,a,r){var s;if("undefined"!=typeof document){if(arguments.length>1){if("number"==typeof(r=e({path:"/"},n.defaults,r)).expires){var o=new Date;o.setMilliseconds(o.getMilliseconds()+864e5*r.expires),r.expires=o}r.expires=r.expires?r.expires.toUTCString():"";try{s=JSON.stringify(a),/^[\{\[]/.test(s)&&(a=s)}catch(e){}a=i.write?i.write(a,t):encodeURIComponent(String(a)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),t=(t=(t=encodeURIComponent(String(t))).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent)).replace(/[\(\)]/g,escape);var l="";for(var d in r)r[d]&&(l+="; "+d,!0!==r[d]&&(l+="="+r[d]));return document.cookie=t+"="+a+l}t||(s={});for(var c=document.cookie?document.cookie.split("; "):[],u=/(%[0-9A-Z]{2})+/g,p=0;p<c.length;p++){var h=c[p].split("="),w=h.slice(1).join("=");this.json||'"'!==w.charAt(0)||(w=w.slice(1,-1));try{var f=h[0].replace(u,decodeURIComponent);if(w=i.read?i.read(w,f):i(w,f)||w.replace(u,decodeURIComponent),this.json)try{w=JSON.parse(w)}catch(e){}if(t===f){s=w;break}t||(s[f]=w)}catch(e){}}return s}}return n.set=n,n.get=function(e){return n.call(n,e)},n.getJSON=function(){return n.apply({json:!0},[].slice.call(arguments))},n.defaults={},n.remove=function(t,i){n(t,"",e(i,{expires:-1}))},n.withConverter=t,n}(function(){})}();var apiUrl="//"+window.deepUtils.getApiUrl()+"/v1/streams/",XHR=win.XMLHttpRequest,SET_REQUEST_HEADER="setRequestHeader",WITH_CREDENTIALS="withCredentials",sendAjax=function(){var e,t=/[^a-zA-Z0-9_-]+/g;if(useAjax()){var i=function(e,i,n,a,r){var s=new XHR,o=apiUrl+i+"/events";return"GET"===e&&r&&(o+="?deepcookie="+r),s.open(e,o),s[WITH_CREDENTIALS]=!0,s[SET_REQUEST_HEADER]("Authorization","bearer "+String(n).replace(t,"")),s.onreadystatechange=function(){if(4==s.readyState&&a){"GET"===e&&ns.setDeepcookie(s.response,i);var t=s.status;a(200===t||204===t||t),a=null}},s};return function t(n,a,r,s,o){if(r.data.user){var l=ns.getFirstPartyCookie();l&&(r.data.user.id.firstparty=l),ns.setFirstPartyCookie(r.data.user.id.firstparty)}if(r.data&&r.data.elements)if("page-ping"===r.data.event.type){var d=[];if(window.deepUtils.each(r.data.elements,function(e){var t=window.deepUtils.deepClone(r.data);delete t.elements,delete t.user.attention,t.event.type=r.data.event.type.replace("page-",""),t.element=e,d.push(t)}),d.length){if("page-ping"===r.data.event.type){var c=window.deepUtils.deepClone(r.data);delete c.elements,d.unshift(c)}r.data=d}else delete r.data.elements}else"page-open"===r.data.event.type&&delete r.data.elements;if(r.data&&r.data.newElements&&"open"===r.data.event.type){var u=[];delete r.data.elements,window.deepUtils.each(r.data.newElements,function(e){var t=window.deepUtils.deepClone(r.data);delete t.newElements,delete t.user.attention,t.event.type=r.data.event.type.replace("page-",""),t.element=e,u.push(t)}),r.data=u}if(r.data&&r.data.event&&"page-ping"!==r.data.event.type&&delete r.data.user.attention,e)if(Array.isArray(e))e.push([n,a,r,s]);else{var p=i("POST",n,a,s);p[SET_REQUEST_HEADER]("Content-Type","application/json"),r.addCookie&&(r.addCookie.set=0),p.send(stringifyAndHash(r))}else e=[],i("GET",n,a,function(i){var o=e;!0!==i?(e=null,s(i),window.deepUtils.each(o,function(e){e[3](i)})):(e=!0,t(n,a,r,s),window.deepUtils.each(o,function(e){t.apply(this,e)}))},o).send()}}return sendJsonP}();function useAjax(){try{return void 0!==(new XHR)[WITH_CREDENTIALS]}catch(e){}return!1}var incrementSendAjaxRetryAfter=2e4,maxSendAjaxRetryAfter=500050;function sendAjaxRetryOnError(e,t,i,n){n||(n=50),win.setTimeout(function(){sendAjax(e,t,i(),function(a){!0!==a&&(0==a||!window.deepUtils.isNumber(a)||a>501)&&n<=maxSendAjaxRetryAfter&&sendAjaxRetryOnError(e,t,i,n+incrementSendAjaxRetryAfter)})},n)}var validatedStreamTracks={};function validateAndCall(e,t,i,n){if(!0===validatedStreamTracks[e])return n();win.clearTimeout(validatedStreamTracks[e]);var a=(ns.options(e)||{}).validate;if(!window.deepUtils.isObject(a))return n();var r,s=a.timeout;window.deepUtils.isNumber(s)&&isFinite(s)&&(r=i+1e3*s-window.deepUtils.nowTime()),!(window.deepUtils.isUndefined(r)||r>=0)||validateDefined(t,a.defined)?(validatedStreamTracks[e]=!0,n()):r>=0&&(validatedStreamTracks[e]=win.setTimeout(function(){validateAndCall(e,t,i,n)},r))}function deepGetProperty(e,t){for(var i=0,n=t.length;i<n;e=e[t[i++]])if(!window.deepUtils.isObject(e))return;return e}function validateDefined(e,t){return!t||(window.deepUtils.isString(t)&&(t=[t]),!Array.isArray(t)||window.deepUtils.every(t,function(t){return!t||!window.deepUtils.isString(t)||void 0!==deepGetProperty(e,t.split("."))}))}var ScrollEventHandler=function(e){var t,i,n,a=!0,r=[];return t=function(e){a&&i(),r.push(e)},n=function(){e.deepUtils.each(r,function(e){e()})},i=function(){a=!1,addEvent(e,"scroll",e.deepBrowserUtils.throttle(n,200))},{onScroll:t}}(window),Marks=(getMarksArray=function(e){var t=[];for(var i in e)e.hasOwnProperty(i)&&t.push(i);return t},{calculate:calculate=function(e){var t=this,i={},n=e?getMarksArray(e):t.options.marks,a=[];if(window.deepUtils.isString(n)){var r=parseInt(n,10),s=0;if(window.deepUtils.isNumber(r))for(;s<=100;)a.push(s+"%"),s+=r}else a=n;window.deepUtils.each(a,function(e,n,a){var r=parseFloat(a[n]);isNaN(r)||(i[r+"%"]=Math.round(t.el.params.currentOffsetToDocumentTop+t.el.params.currentHeight*(parseFloat(e)/100)))}),this.marks=i},check:function(e){var t=this;for(var i in t.marks&&!DeepElements.updateElementMeasurements(t.el)||calculate.call(this,t.marks),t.marks)t.marks.hasOwnProperty(i)&&e>=t.marks[i]&&(t.sendEvent({mark:parseInt(i,10)+"%",viewabletime:t.el.timer.getMarkTime()}),delete t.marks[i])},marksExists:function(){for(var e in this.marks)if(this.marks.hasOwnProperty(e))return!1;return!0}}),calculate,getMarksArray,ScrollDepth,Viewability,Clickability,ClickabilityGlobal;window.visibly={q:document,p:void 0,prefixes:["webkit","ms","o","moz","khtml"],props:["VisibilityState","visibilitychange","Hidden"],m:["focus","blur"],visibleCallbacks:[],hiddenCallbacks:[],genericCallbacks:[],_callbacks:[],cachedPrefix:"",fn:null,onVisible:function(e){"function"==typeof e&&this.visibleCallbacks.push(e)},onHidden:function(e){"function"==typeof e&&this.hiddenCallbacks.push(e)},getPrefix:function(){if(!this.cachedPrefix)for(var e,t=0;e=this.prefixes[t++];)if(e+this.props[2]in this.q)return this.cachedPrefix=e,this.cachedPrefix},visibilityState:function(){return this._getProp(0)},hidden:function(){return this._getProp(2)},visibilitychange:function(e){"function"==typeof e&&this.genericCallbacks.push(e);var t=this.genericCallbacks.length;if(t)if(this.cachedPrefix)for(;t--;)this.genericCallbacks[t].call(this,this.visibilityState());else for(;t--;)this.genericCallbacks[t].call(this,arguments[0])},isSupported:function(e){return this._getPropName(2)in this.q},_getPropName:function(e){return""==this.cachedPrefix?this.props[e].substring(0,1).toLowerCase()+this.props[e].substring(1):this.cachedPrefix+this.props[e]},_getProp:function(e){return this.q[this._getPropName(e)]},_execute:function(e){if(e){this._callbacks=1==e?this.visibleCallbacks:this.hiddenCallbacks;for(var t=this._callbacks.length;t--;)this._callbacks[t]()}},_visible:function(){window.visibly._execute(1),window.visibly.visibilitychange.call(window.visibly,"visible")},_hidden:function(){window.visibly._execute(2),window.visibly.visibilitychange.call(window.visibly,"hidden")},_nativeSwitch:function(){this[this._getProp(2)?"_hidden":"_visible"]()},_listen:function(){try{this.isSupported()?this.q.addEventListener(this._getPropName(1),function(){window.visibly._nativeSwitch.apply(window.visibly,arguments)},1):this.q.addEventListener?(window.addEventListener(this.m[0],this._visible,1),window.addEventListener(this.m[1],this._hidden,1)):this.q.attachEvent&&(this.q.attachEvent("onfocusin",this._visible),this.q.attachEvent("onfocusout",this._hidden))}catch(e){}},init:function(){this.getPrefix(),this._listen()}},window.visibly.init(),function(){var e={marks:["20%","40%","60%","80%","90%","100%"]},t=function(e,t){this.el=e,this.options=t,this.check()};t.prototype={sendEvent:function(e){DeepElements.sendEvent(this.el,"scrolldepth",e)},check:function(){var e=window.deepBrowserUtils.getScrollDistance();Marks.check.call(this,e),window.deepUtils.isEmpty(this.marks)&&i.removeElement(this.el)}};var i={elements:[],isFirstInit:!0,scrollEventHandler:function(){window.deepUtils.each(i.elements,function(e){e.check()})},init:function(){i.isFirstInit=!1,ScrollEventHandler.onScroll(i.scrollEventHandler),visibly.visibilitychange(i.scrollEventHandler)},removeElement:function(e){window.deepUtils.each(i.elements,function(t,n){e.streamKey===t.el.streamKey&&e.selector===t.el.selector&&i.elements.splice(n,1)})},addElement:function(n,a){i.isFirstInit&&i.init(),a=window.deepBrowserUtils.extend({},e,a);var r=new t(n,a);i.elements.push(r)}};ScrollDepth={addElement:i.addElement}}(window,document),function(){var e={mark:"50%",time:1e3},t=function(e,t){this.el=e,this.options=t,this.timeout=null,this.timeoutTime=parseInt(t.time,10),this.eventSent=!1,this.isCounting=!1,this.elapsedTime=0,this.startTime=0,this.check()};t.prototype={check:function(){this.isOnScreen()&&!visibly.hidden()?this.startCount():this.stopCount()},startCount:function(){var e=this;this.isCounting||this.eventSent||(this.isCounting=!0,this.startTime=+new Date,this.timeout=setTimeout(function(){e.eventSent=!0,DeepElements.sendEvent(e.el,"viewable",{mark:e.options.mark,time:e.timeoutTime}),i.removeElement(e.el)},this.timeoutTime-this.elapsedTime))},stopCount:function(){this.isCounting&&(this.isCounting=!1,clearTimeout(this.timeout),this.elapsedTime+=+new Date-this.startTime)},isHidden:function(){var e=this.el.domEl,t=!0;return e&&(t=0===e.offsetWidth&&0===e.offsetHeight),t},isOnScreen:function(){var e,t,i,n=!1,a=this.el.domEl;return a&&(n=window.innerHeight>=(e=a.getBoundingClientRect().top)+(i=((t=a.getBoundingClientRect().bottom)-e)*(parseFloat(this.options.mark)/100))&&t>=i),n&&!this.isHidden()}};var i={elements:[],isFirstInit:!0,scrollEventHandler:function(){window.deepUtils.each(i.elements,function(e){e.check()})},removeElement:function(e){window.deepUtils.each(i.elements,function(t,n){e.streamKey===t.el.streamKey&&e.selector===t.el.selector&&i.elements.splice(n,1)})},init:function(){i.isFirstInit=!1,ScrollEventHandler.onScroll(i.scrollEventHandler),visibly.visibilitychange(i.scrollEventHandler)},addElement:function(n,a){i.isFirstInit&&i.init(),a=window.deepBrowserUtils.extend({},e,a);var r=new t(n,a);i.elements.push(r)}};Viewability={addElement:i.addElement}}(window,document),window,document,ClickabilityGlobal={sendEvent:function(e){DeepElements.sendEvent(e,"click")},bindClick:function(e){e.domEl&&addEvent(e.domEl,"click",window.deepBrowserUtils.throttle(function(){ClickabilityGlobal.sendEvent(e)},200))},addElement:function(e){ClickabilityGlobal.bindClick(e)}},Clickability={addElement:ClickabilityGlobal.addElement};var DeepElementsTransformation=(allowedEvents=["open","ping"],updateDeviceData=function(e){e.documentheight=window.deepBrowserUtils.getDocumentHeight(),e.viewportheight=window.deepBrowserUtils.getWindowHeight()},{checkIfMetaTransformationNeeded:function(e,t){return DeepElements.hasElements(t)&&isAllowToTransformData(e.data.event.type)&&updateDeviceData(e.data.user.device.screen),e},isAllowToTransformData:isAllowToTransformData=function(e){return e=e.replace("page-",""),allowedEvents.indexOf(e)>-1}}),isAllowToTransformData,updateDeviceData,allowedEvents,DeepElements=(registeredElements=[],isLoaded=!1,isRegistered=function(e,t){var i=!1;return window.deepUtils.each(registeredElements[t],function(t){if(e.selector===t.selector)return i=!0,!1}),i},register=function(e,t,i){var n=null;return e.type&&e.selector&&t&&(i=i||{},e.domEl=document.querySelector(e.selector),e.streamKey=t,registeredElements[t]?isRegistered(e,t)||(registeredElements[t].push(e),bindAnalytics(e,i)):(registeredElements[t]=[e],bindAnalytics(e,i)),n=e),n},getElementDataToSend=function(e){var t={type:e.type,selector:e.selector,params:e.params};return e.details&&(t.details=e.details),t},getElementsDataToSend=function(e){var t=[];return window.deepUtils.each(registeredElements[e],function(e){var i=getElementDataToSend(e);i.params=window.deepBrowserUtils.extend({},i.params,{viewabletime:e.timer.getElapsedTime()}),t.push(i)}),t},isAllowToRun=function(e,t){var i=!1;for(var n in t)t.hasOwnProperty(n)&&(i=e[n]&&e[n]==t[n]);return i},bindAnalytics=function(e,t){e.params={},e.timer=new DeepElementViewTimer(e),updateElementMeasurements(e),t.scrolldepth&&!window.deepUtils.isEmpty(t.scrolldepth.elements)&&window.deepUtils.each(t.scrolldepth.elements,function(i){if(isAllowToRun(e,i))return ScrollDepth.addElement(e,t.scrolldepth),!1}),t.viewability&&!window.deepUtils.isEmpty(t.viewability.elements)&&window.deepUtils.each(t.viewability.elements,function(i){if(isAllowToRun(e,i))return Viewability.addElement(e,t.viewability),!1}),t.click&&!window.deepUtils.isEmpty(t.click.elements)&&window.deepUtils.each(t.click.elements,function(i){if(isAllowToRun(e,i))return Clickability.addElement(e,t.click),!1})},sendOpenEvent=function(e,t){var i=ns.track(t),n=[];window.deepUtils.each(e,function(e){n.push(getElementDataToSend(e))}),i.event({event:{type:"open"},newElements:n})},{init:function(){isLoaded||(isLoaded=!0,ns.forEachStream(function(e){var t=ns.getTracker(e).elements;Array.isArray(t)&&addElements(t,e)}))},addElements:addElements=function(e,t){var i,n=ns.options(t),a=[];window.deepUtils.each(e,function(e){(i=register(e,t,n))&&a.push(i)}),sendOpenEvent(a,t)},extendData:function(e,t){return DeepElementsTransformation.isAllowToTransformData(e.event.type)&&(e.elements=getElementsDataToSend(t)),e},hasElements:function(e){return!(!registeredElements[e]||!registeredElements[e].length)},sendEvent:function(e,t,i){var n=ns.track(e.streamKey),a=getElementDataToSend(e);a.params=window.deepBrowserUtils.extend({},a.params,i),n.event({event:{type:t},element:a})},updateElementMeasurements:updateElementMeasurements=function(e){var t,i,n=!1;return e.domEl&&(t=window.deepBrowserUtils.getElementYOffsetToDocumentTop(e.domEl),i=window.deepBrowserUtils.getElementHeight(e.domEl),t===e.params.currentOffsetToDocumentTop&&i===e.params.currentHeight||(window.deepUtils.isNullOrUndefined(e.params.startOffsetToDocumentTop)&&window.deepUtils.isNullOrUndefined(e.params.startHeight)&&(e.params.startOffsetToDocumentTop=t,e.params.startHeight=i),e.params.currentOffsetToDocumentTop=t,e.params.currentHeight=i,n=!0)),n}}),register,isRegistered,addElements,getElementDataToSend,getElementsDataToSend,updateElementMeasurements,bindAnalytics,isAllowToRun,sendOpenEvent,registeredElements,isLoaded;function addPageDynamicAttributes(e,t,i){var n=win[LOCATION],a=n,r=t.options(i)||{};r.pageCanonical&&(a=fetchCanonicalUrl()||a);var s,o=e.page=window.deepUtils.isPlainObject(e.page)?window.deepUtils.shallowClone(e.page):{};r.pageCanonicalPath&&window.deepUtils.isString(r.pageCanonicalPath)&&(a=parseUrl(r.pageCanonicalPath)),window.deepUtils.isString(o.path)&&(s=o.path.trim())&&(a=parseUrl(s)),window.deepUtils.safeExtend(o,locationAttributes(a)),o.domain||(o.domain=domainFromLocation(a)),o.hash||(o.hash=n.hash),window.deepUtils.safeExtend(e,window.sessionManager.getData(e)),window.deepUtils.safeExtend(e,DeepElements.extendData(e,i))}var filterMetaBeforeSend=function(e,t,i){var n=(e=window.deepUtils.shallowClone(e)).data=window.deepUtils.shallowClone(e.data);n.event=window.deepUtils.shallowClone(n.event);return addPageDynamicAttributes(n,t,i),n.event.timestamp=Math.max(window.deepUtils.nowTime()-n.event.timestamp,0),window.deepUtils.safeExtend(e,DeepElementsTransformation.checkIfMetaTransformationNeeded(e,i)),e},preProcessEventData=function(e,t,i){delete e.event.type,delete e.event.timestamp},postProcessEventMeta=function(e,t,i){var n=e.data;delete n.page.loadtime;var a=n.event.timestamp;window.deepUtils.isNumber(a)&&isFinite(a)||(n.event.timestamp=window.deepUtils.nowTime());var r=n.event.type;window.deepUtils.isString(r)&&r||(n.event.type="custom-event"),setupDeepAttentionMeta(e,t,i)},getBrowserDnt=function(){return!!(navigator.doNotTrack||navigator.msDoNotTrack||win.doNotTrack)},postProcessTrackerMeta=function(e,t,i,n,a){var r=e.data,s=(win[LOCATION],doc.referrer);s=s?parseUrl(s):{};var o=win.screen||{},l=o.orientation||o.mozOrientation||o.msOrientation;window.deepUtils.isObject(l)&&window.deepUtils.isString(l.type)&&(l=l.type);var d=n,c=t.getInitTime().getTime(),u=d-c,p=performance.timing;p&&(u=p.domInteractive-p.fetchStart),Date.prototype.ddmmyyyy=function(){var e=this.getMonth()+1,t=this.getDate();return[this.getFullYear(),(e>9?"":"0")+e,(t>9?"":"0")+t].join("-")};var h=new Date;window.deepUtils.deepExtend(r,{event:{type:"page-open",timestamp:Math.min(d,c),"localtime.utcoffset":window.deepUtils.utcOffset,"localtime.date":h.ddmmyyyy()},user:{device:{browserua:{general:{dnt:getBrowserDnt()}},screen:{width:o.width,height:o.height,availwidth:o.availWidth,availheight:o.availHeight,orientation:window.deepUtils.isString(l)?l:void 0}},id:{session:cuid(),firstparty:window.deepTracker.getFirstPartyCookie()||cuid()}},page:{},referrer:locationAttributes(s,1)});var w=t.options(i)||{},f=r.page.path;window.deepUtils.isString(f)&&(f=r.page.path.trim())&&(w.pageCanonicalPath=f),u>=0&&(r.page.loadtime=u),r.page.title&&window.deepUtils.isString(r.page.title)||(r.page.title=fetchTitle()),t.applyCollectedData(e),t.applyPianoData(e),t.applyGlobalVariablesCollectedData(e),setupDeepAttentionMeta(e,t,i),initAttention(e,t,i,a)};function setupDeepAttentionMeta(e,t,i){var n=win.navigator||{},a=t.options(i)||{},r=getBrowserDnt(),s=a.trackconsent||a.consent||!1;window.deepUtils.safeExtend(e,{getEventTime:{field:["event","timestamp"],sub:1},addDeviceHeaders:["user","device","headers"],addRemoteAddress:["user","id","ip"],tran:[{dateSplit:{fromField:["event","timestamp"],toField:["event","localtime"],parts:["date","hour","minute","weekday","weekdayno","utcoffset","week"],utcoffset:["event","localtime","utcoffset"]}},{compact:{}}],enrich:[{ip2location:{fromField:"user.id.ip",toField:"user.location"}},{detectDevice:{fromField:"user.device.headers",toField:"user.device",mode:"merge"}}]}),(!1!==n.cookieEnabled&&!r&&s||a.dntignore)&&window.deepUtils.safeExtend(e,{addCookie:{field:["user","id","deepcookie"]}}),a.hasOwnProperty("identifyBy")&&a.identifyBy&&window.deepUtils.safeExtend(e,{identifyBy:a.identifyBy}),t.applyCollectedData(e),t.applyPianoData(e),t.applyGlobalVariablesCollectedData(e)}function fetchHeadTags(e){var t=doc[GET_ELEMENTS_BY_TAG_NAME](HEAD)[0];return t?t[GET_ELEMENTS_BY_TAG_NAME](e):[]}function fetchCanonicalUrl(){for(var e=fetchHeadTags("link"),t=e.length;t-- >0;)if("canonical"===e[t].rel&&e[t].href)return parseUrl(e[t].href)}function fetchTitle(){var e=fetchHeadTags("title");return e.length?getText(e).trim():""}function initAttention(e,t,i,n){var a=e.data;(e=window.deepUtils.shallowClone(e)).data=void 0;var r="_dpAttention_unloaded_ MAfdz1HC9XrMEWeQWTeHBCGe."+i,s=5e3,o=15e3,l=192e4,d=144e5,c=1e3,u=5e3,p=1e3,h=o,w=0,f=0,m=0,v=Math.min(window.deepUtils.nowTime(),a.event.timestamp),g=v+s,y=!0,E=null,k=0;function U(){var n=e.data=window.deepUtils.shallowClone(a),r=n.event=window.deepUtils.shallowClone(n.event),s=n.page=window.deepUtils.shallowClone(n.page);r.type="page-ping",r.timestamp=0;var o=n.user.attention=window.deepUtils.shallowClone({total:w,active:f,idle:w-f,secondsSpent:parseInt((Date.now()-t.getInitTime().getTime())/1e3,10)});return r.pingseq=++m,delete s.loadtime,t.applyCollectedData(e),t.applyPianoData(e),t.applyGlobalVariablesCollectedData(e),addPageDynamicAttributes(n,t,i),window.deepUtils.safeExtend(e,DeepElementsTransformation.checkIfMetaTransformationNeeded(e,i)),o}function S(){k=window.deepUtils.nowTime()+h,E=win.setTimeout(D,h)}function C(){if(E)return win.clearTimeout(E),E=null,k=0,!0}function D(){if(C()){var t=U();n(e,function(e){!0===e&&(w-=t.total,f-=t.active),y?h=o:h<l&&(h+=h),S()})}}var T=null;function A(e){T&&(win.clearTimeout(T),T=null);var t=window.deepUtils.nowTime(),i=Math.min(Math.max(t-v,0),p);w+=i,t>=g?y&&(v<g&&(f+=Math.min(g-v,p)),y=!1):y?f+=i:(y=!0,h!=o&&k-window.deepUtils.nowTime()>o&&(h=o,C()&&S())),v=t,e||(T=win.setTimeout(A,100))}function b(){g=window.deepUtils.nowTime()+s,A()}function _(){y&&(g=window.deepUtils.nowTime()),A()}var O=doc[GET_ELEMENTS_BY_TAG_NAME]("body")[0];addEvent(win,"focus",b),addEvent(win,"scroll",b),addEvent(win,"resize",b),addEvent(O,"mousemove",b),addEvent(O,"mousedown",b),addEvent(O,"keydown",b),addEvent(win,"blur",_),addEvent(win,"pagehide",_),addEvent(win,"pageshow",b),addEvent(win,"focusin",b),addEvent(win,"focusout",_),addEvent(win,"unload",function(){if(g=window.deepUtils.nowTime(),A(1),C()&&w>=c&&(m||w>=u)){U(),e.data.event.timestamp=g;try{win.localStorage.setItem(r,stringifyAndHash(e))}catch(e){}}}),function e(){try{var t,i,a=win.localStorage.getItem(r);window.deepUtils.isString(a)&&a&&(a=jsonParse(a),window.deepUtils.isObject(a)&&window.deepUtils.isObject(t=a.data)&&window.deepUtils.isObject(t.event)&&window.deepUtils.isNumber(i=t.event.timestamp)&&isFinite(i)&&(i=window.deepUtils.nowTime()-i)<d?(t.event.timestamp=Math.max(i,0),n(a,function(t){!0===t?win.localStorage.removeItem(r):win.setTimeout(e,o)})):win.localStorage.removeItem(r))}catch(e){}}(),S(),A()}var ns=window.deepTracker,postProcessTrackerMeta,preProcessEventData,postProcessEventMeta,filterMetaBeforeSend;function fixDimensionNames(e,t){var i=/[^a-zA-Z0-9.$_-]/g;if(t||(t=0),Array.isArray(e))e=window.deepUtils.map(e,function(e){return fixDimensionNames(e,t)});else if(window.deepUtils.isPlainObject(e)){var n,a,r={};for(n in e)(a=t+n.length)<=64&&window.deepUtils.hasOwnProperty.call(e,n)&&(r[n.replace(i,"_")]=fixDimensionNames(e[n],a+1));e=r}return e}function stringifyAndHash(e){return stringify(fixDimensionNames(e),function(e,t){if(window.deepUtils.isFunction(t)&&"hash"===t.name){if(!window.deepUtils.isString(t=t()))return;t=hash128(encodeUtf8(t),1145390416)}return t})}function prepareErrorEvents(){var e=win.XMLHttpRequest=function(){var e=new XHR;return addEvent(e,"load",function(){e.status>=400&&ns.errors.push([new Date,{status:e.status,message:e.statusText,responseURL:e.responseURL}])}),e};(e.prototype=window.deepUtils.create(XHR.prototype)).constructor=e;var t=ns.errors,i={};function n(e){for(var t in i){var n=i[t],a=(n[0],n[1],ns.track(t));window.deepUtils.each(e,function(e){var t=e[0].getTime(),i=e[1],n=i.target,r=n&&n.nodeName;a.event({event:{type:"page-error",timestamp:t},error:{message:i.message,status:i.status,responseurl:i.responseURL,filename:i.filename,lineno:i.lineno,colno:i.colno,target:r&&{nodename:(""+r).toLowerCase(),src:n.src&&""+n.src,href:n.href&&""+n.href}}})})}}ns.each(function(e,t,n){var a=(ns.options(e)||{}).errors;a&&(i[e]||(i[e]=[a,n]))}),window.deepUtils.isEmpty(i)||(ns.errors={push:function(e){win.setTimeout(n,50,[e])}},n(t))}onDOMContentLoaded(win,doc,function(){if(window.deepUtils.isObject(ns)&&window.deepUtils.isFunction(ns.each)&&window.deepUtils.isFunction(ns.getInitTime)&&window.deepUtils.isFunction(ns.track)){var e,t=window.deepUtils.nowTime(),i={},n=[],a={},r={};DeepElements&&DeepElements.init(),ns.each(function(a,r,s){var l=i[a]||(i[a]=[window.deepUtils.create(null)]),d=window.deepUtils.create(null);if(window.deepUtils.isFunction(r)){var c=r(d);r=window.deepUtils.isPlainObject(c)?c:d}else window.deepUtils.isUndefined(r)&&(r=d);window.deepUtils.isString(s)&&(l[1]=s),window.deepUtils.isPlainObject(r)&&(ns.createMediaStream(a),ns.collectData(a),ns.collectGlobalVariablesData(a),ns.collectPianoData(a),ns.handlePianoEvents(a),ns.initializeCookieMatcher(a),validateAndCall(a,window.deepUtils.deepExtend(l[0],r),t,function(){ns.setSharedData(l[0]),function(t,i,n){e&&win.clearTimeout(e);e=win.setTimeout(function(){o(t,i,n)},50)}(i,n,postProcessTrackerMeta)}))}),ns.each.length>1&&(ns.each(function(e,t){DeepElements.addElements(t,e)},6),ns.each(function(e,t,a){var o=i[e];o&&~n.indexOf(e)?s(o,e,t,a):(r[e]||(r[e]=[])).push([t,a])},2),ns.each(function(e,t,a){var s=i[e];s&&~n.indexOf(e)?window.deepUtils.deepExtend(s[0],t,!1):(r[e]||(r[e]=[])).push([t,a])},4),ns.each(function(e,t){var i=a[e]||[];Array.isArray(t)?window.deepUtils.every(t,window.deepUtils.isPlainObject)&&(i=t):window.deepUtils.isPlainObject(t)&&i.push(t),a[e]=i},3))}function s(e,t,i,n){var a=window.deepUtils.deepClone(e[0]),r={},s=r[t]=[a,e[1]];if(window.deepUtils.isFunction(i)){var l=window.deepUtils.create(null),d=i(l);i=window.deepUtils.isPlainObject(d)?d:l}window.deepUtils.isString(n)&&(s[1]=n),window.deepUtils.isPlainObject(i)&&(window.deepUtils.isFunction(preProcessEventData)&&preProcessEventData(a,ns,t),window.deepUtils.deepExtend(a,i,!0),o(r,null,postProcessEventMeta))}function o(e,i,n){var a=function(){var a=(ns.options(o)||{}).forceDeepcookie?ns.getDeepcookie():null;i&&~i.indexOf(o)||(i&&i.push(o),d=window.deepUtils.create(null),c=e[o],u=c[1],d.data=c[0],window.deepUtils.isFunction(n)&&n(d,ns,o,t,function(e,t){return sendAjax(o,u,l(e,o),t,a)}),sendAjaxRetryOnError(o,u,function(){return l(window.deepUtils.isFunction(filterMetaBeforeSend)?filterMetaBeforeSend(d,ns,o):d,o)}),(p=r[o])&&(delete r[o],window.deepUtils.each(p,function(e){s(c,o,e[0],e[1])})))};for(var o in e){var d,c,u,p;a()}}function l(e,t){var i=ns.options(t)||{},n=(ns.options(t)||{}).trackconsent||(ns.options(t)||{}).consent||!1,r=a[t];if(r){var s=(e=window.deepUtils.shallowClone(e)).tran||e.transform||e.transformation;Array.isArray(s)?e.tran=r.concat(s):e.tran=r}e.data.dmascript={version:"3.0.375",releasedate:"2020-11-09",dntignore:i.dntignore},e.data.user.consents={gdpr:n};var o=(ns.options(t)||{}).inject;return o&&"object"===(void 0===o?"undefined":_typeof(o))&&(e.data.inject=Object.assign({},o)),e}}),Array.isArray(ns.errors)&&onLoad(win,prepareErrorEvents);var performanceFields=window.deepUtils.$w("name startTime"),performanceSelfNameRe=new RegExp("https?://"+window.deepUtils.getApiUrl()+"/v1/streams/[^/]+/events");function preparePerformanceEvents(){var e=window.deepUtils.nowTime(),t={};if(ns.each(function(e,i,n){var a=(ns.options(e)||{}).performance;a&&(t[e]||(t[e]=[a,n]))}),!window.deepUtils.isEmpty(t)){var i=performance.getEntriesByType("resource");for(var n in t){var a=t[n],r=a[0],s=(a[1],ns.track(n)),o=d(r);window.deepUtils.each(o,function(t){var i;!t.initiatorType||"xmlhttprequest"===t.initiatorType&&performanceSelfNameRe.test(t.name)||(i=l(t))&&s.event({event:{type:"resource-performance",timestamp:e},resource:i})})}}function l(e){var t=e.duration,i={type:e.initiatorType,duration:t,endtime:e.startTime+t};if(window.deepUtils.isNumber(t)&&isFinite(t)&&t>=0)return window.deepUtils.each(performanceFields,function(t){i[t.toLowerCase()]=e[t]}),i}function d(e){var t=[];return Array.isArray(e)?t=window.deepUtils.flatMap(e,d):window.deepUtils.isString(e)?/^(?:link|script|css|img|iframe|xmlhttprequest)$/.test(e)?window.deepUtils.each(i,function(i){i.initiatorType===e&&t.push(i)}):window.deepUtils.each(i,function(i){~(""+i.name).indexOf(e)&&t.push(i)}):e instanceof RegExp?window.deepUtils.each(i,function(i){e.test(i.name)&&t.push(i)}):t=window.deepUtils.toArray(i),t}}window.deepUtils.isFunction(performance.getEntriesByType)&&onLoad(win,preparePerformanceEvents)}();